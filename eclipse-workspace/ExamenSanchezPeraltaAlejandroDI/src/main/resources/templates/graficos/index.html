<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>GrÃ¡ficos</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
</head>
<body class="bg-light">

  <div th:replace="~{fragments/navbar :: navbar}"></div>

  <div class="container mt-4">
    <h2 class="mb-4">ðŸ“Š EstadÃ­sticas de NÃ¡ufragos</h2>

    <div class="row g-4">

      <!-- GrÃ¡fico de barras: nÃ¡ufragos por nacionalidad -->
      <div class="col-md-7">
        <div class="card shadow border-0 h-100">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">NÃ¡ufragos por Nacionalidad</h5>
          </div>
          <div class="card-body d-flex align-items-center justify-content-center">
            <canvas id="chartNacionalidad" style="max-height:350px;"></canvas>
          </div>
        </div>
      </div>

      <!-- GrÃ¡fico donut: nÃ¡ufragos por sexo -->
      <div class="col-md-5">
        <div class="card shadow border-0 h-100">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">NÃ¡ufragos por Sexo</h5>
          </div>
          <div class="card-body d-flex align-items-center justify-content-center">
            <canvas id="chartSexo" style="max-height:350px;"></canvas>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // â”€â”€ Paleta de colores â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const COLORS = [
      '#4e79a7','#f28e2b','#e15759','#76b7b2',
      '#59a14f','#edc948','#b07aa1','#ff9da7',
      '#9c755f','#bab0ac'
    ];

    // â”€â”€ GrÃ¡fico de BARRAS: por Nacionalidad â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    fetch('/api/graficos/por-nacionalidad')
      .then(r => r.json())
      .then(data => {
        new Chart(document.getElementById('chartNacionalidad'), {
          type: 'bar',
          data: {
            labels: data.map(d => d.label),
            datasets: [{
              label: 'NÃ¡ufragos',
              data: data.map(d => d.count),
              backgroundColor: COLORS.slice(0, data.length),
              borderColor: COLORS.slice(0, data.length),
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              title: { display: false }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: { stepSize: 1 }
              }
            }
          }
        });
      })
      .catch(() => {
        document.getElementById('chartNacionalidad')
          .closest('.card-body').innerHTML =
          '<p class="text-muted text-center">Sin datos disponibles</p>';
      });

    // â”€â”€ GrÃ¡fico DONUT: por Sexo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    fetch('/api/graficos/por-sexo')
      .then(r => r.json())
      .then(data => {
        new Chart(document.getElementById('chartSexo'), {
          type: 'doughnut',
          data: {
            labels: data.map(d => d.label),
            datasets: [{
              data: data.map(d => d.count),
              backgroundColor: ['#4e79a7', '#e15759', '#76b7b2'],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              title: { display: false }
            }
          }
        });
      })
      .catch(() => {
        document.getElementById('chartSexo')
          .closest('.card-body').innerHTML =
          '<p class="text-muted text-center">Sin datos disponibles</p>';
      });
  </script>
</body>
</html>

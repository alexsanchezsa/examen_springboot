# ================================================================
# YAML CI - Ejecución de Tests (Ejercicio 6a)
# ================================================================
# Nombre del workflow que aparecerá en GitHub Actions
name: CI - Ejecucion de Tests

# ----------------------------------------------------------------
# Disparador: workflow_dispatch = ejecución MANUAL desde GitHub
# El workflow solo se lanza cuando el usuario lo inicia a mano
# desde la pestaña "Actions" del repositorio en GitHub
# ----------------------------------------------------------------
on:
  workflow_dispatch:

# ----------------------------------------------------------------
# Definición de los jobs (tareas) del pipeline
# ----------------------------------------------------------------
jobs:
  test:
    # Nombre descriptivo que aparecerá en la interfaz de GitHub
    name: Tests en ${{ matrix.os }}

    # ----------------------------------------------------------------
    # Estrategia de MATRIZ: ejecuta el job en paralelo para cada OS
    # ubuntu-latest → runner Linux de GitHub Actions
    # windows-latest → runner Windows de GitHub Actions
    # ----------------------------------------------------------------
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
      fail-fast: false  # Si falla un SO, el otro continúa ejecutándose

    # El runner donde se ejecuta este job (varía según la matriz)
    runs-on: ${{ matrix.os }}

    steps:
      # ----------------------------------------------------------------
      # PASO 1: Descargar el código fuente del repositorio
      # actions/checkout trae la rama actual al runner
      # ----------------------------------------------------------------
      - name: Checkout del codigo fuente
        uses: actions/checkout@v4

      # ----------------------------------------------------------------
      # PASO 2: Configurar Java 21 (versión requerida por el proyecto)
      # Temurin es la distribución OpenJDK de Eclipse Foundation
      # ----------------------------------------------------------------
      - name: Configurar Java 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: 'maven'  # Cachea las dependencias Maven entre ejecuciones

      # ----------------------------------------------------------------
      # PASO 3: Ejecutar los tests con Maven Wrapper
      # Se usa shell: bash para que funcione igual en Ubuntu y Windows
      # Los tests usan H2 en memoria (no necesitan MySQL)
      # ----------------------------------------------------------------
      - name: Ejecutar tests con Maven
        shell: bash
        run: ./mvnw test --no-transfer-progress
